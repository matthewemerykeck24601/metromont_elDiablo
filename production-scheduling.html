<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Scheduling - Precast Bed Scheduler | Metromont CastLink</title>
    <link rel="stylesheet" href="styles/production-scheduling.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>
</head>
<body class="auth-loading">
    <!-- Auth Processing Overlay -->
    <div class="auth-processing active" id="authProcessing">
        <div class="auth-processing-content">
            <div class="loading"></div>
            <h3 id="authTitle">Initializing Production Scheduler</h3>
            <p id="authMessage">Loading ACC Assets and bed configurations...</p>
        </div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="assets/images/metromont-logo.png" alt="Metromont Logo" class="logo" />
                <div class="brand-text">
                    <h1>Production Scheduling</h1>
                    <p>Intelligent Precast Bed Scheduler</p>
                </div>
            </div>
            <div class="nav-breadcrumb">
                <a href="index.html">Dashboard</a>
                <span>→</span>
                <span>Production Scheduling</span>
            </div>
            <div class="header-buttons">
                <button class="btn btn-back" onclick="window.location.href='index.html'">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                    </svg>
                    Back to Dashboard
                </button>
                <div class="status-badge status-connected" id="authStatusBadge" style="display: none;">
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                    </svg>
                    Connected to ACC
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="control-section">
                <h3>Schedule Controls</h3>
                <div class="control-group">
                    <label for="projectSelect">Project</label>
                    <select id="projectSelect" onchange="onProjectChange()">
                        <option value="">Loading projects...</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dateSelect">Schedule Date</label>
                    <input type="date" id="dateSelect" onchange="onDateChange()">
                </div>
                <div class="control-group">
                    <label for="bedSelect">Production Bed</label>
                    <select id="bedSelect" onchange="onBedChange()">
                        <option value="">Select a bed...</option>
                        <option value="beam">Beam Bed</option>
                        <option value="deck1">Deck Bed #1</option>
                        <option value="deck2">Deck Bed #2</option>
                        <option value="flatbed1">Flat Bed #1</option>
                        <option value="flatbed2">Flat Bed #2</option>
                        <option value="flatbed3">Flat Bed #3</option>
                        <option value="flatbed4">Flat Bed #4</option>
                        <option value="flatbed5">Flat Bed #5</option>
                        <option value="flatbed6">Flat Bed #6</option>
                        <option value="flatbed7">Flat Bed #7</option>
                    </select>
                </div>
                <div class="control-actions">
                    <button class="btn btn-primary" onclick="saveBedSchedule()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z" />
                        </svg>
                        Save Schedule
                    </button>
                    <button class="btn btn-secondary" onclick="toggleViewMode()">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34 3-3-3z" />
                        </svg>
                        Toggle View
                    </button>
                </div>
            </div>

            <div class="control-section">
                <h3>Bed Information</h3>
                <div class="bed-info" id="bedInfo">
                    <div class="info-item">
                        <span class="info-label">Type:</span>
                        <span class="info-value" id="bedType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Length:</span>
                        <span class="info-value" id="bedLength">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Width:</span>
                        <span class="info-value" id="bedWidth">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status:</span>
                        <span class="info-value status-badge" id="bedStatus">Available</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Design #:</span>
                        <span class="info-value" id="currentDesignNumber">None</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pieces:</span>
                        <span class="info-value" id="pieceCount">0</span>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>Schedule Status</h3>
                <div class="schedule-status">
                    <div class="status-item">
                        <label>Date Scheduled:</label>
                        <input type="datetime-local" id="dateScheduled" onchange="updateScheduleStatus()">
                    </div>
                    <div class="status-item">
                        <label>Date Poured:</label>
                        <input type="datetime-local" id="datePoured" onchange="updateScheduleStatus()">
                    </div>
                    <div class="status-item">
                        <label>Pour Status:</label>
                        <select id="pourStatus" onchange="updateScheduleStatus()">
                            <option value="scheduled">Scheduled</option>
                            <option value="setup">Setup Complete</option>
                            <option value="poured">Poured</option>
                            <option value="curing">Curing</option>
                            <option value="stripped">Stripped</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- 3D Viewer -->
            <div class="viewer-container" id="viewerContainer">
                <div class="viewer-toolbar">
                    <button class="viewer-btn" onclick="resetCamera()" title="Reset View">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                        </svg>
                    </button>
                    <button class="viewer-btn" onclick="toggleGrid()" title="Toggle Grid">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M8 4v1.45l2 2V4h4v4h-3.45l2 2H14v1.45l2 2V10h4v4h-3.45l2 2H20v1.45l2 2V4c0-1.1-.9-2-2-2H4.55l2 2H8zm8 0h4v4h-4V4zM1.27 1.27L0 2.55l2 2V20c0 1.1.9 2 2 2h15.46l2 2 1.27-1.27L1.27 1.27zM10 12.55L11.45 14H10v-1.45zm-6-6L5.45 8H4V6.55zM8 20H4v-4h4v4zm0-6H4v-4h3.45l.55.55V14zm6 6h-4v-4h3.45l.55.55V20zm2 0v-1.46L17.46 20H16z" />
                        </svg>
                    </button>
                    <button class="viewer-btn" onclick="toggleStrandPattern()" title="Toggle Strand Pattern">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M7 2v11h3v9l7-12h-4l4-8z" />
                        </svg>
                    </button>
                    <div class="viewer-info">
                        <span id="viewerStatus">Ready</span>
                    </div>
                </div>
                <div id="threejsContainer"></div>
            </div>

            <!-- Assets Panel -->
            <div class="assets-panel">
                <div class="assets-header">
                    <h3>Available Pieces</h3>
                    <input type="text" id="assetSearch" placeholder="Search by mark or design..." onkeyup="filterAssets()">
                </div>
                <div class="assets-filter">
                    <select id="designFilter" onchange="filterAssets()">
                        <option value="">All Designs</option>
                    </select>
                    <select id="typeFilter" onchange="filterAssets()">
                        <option value="">All Types</option>
                        <option value="beam">Beams</option>
                        <option value="column">Columns</option>
                        <option value="wall">Walls</option>
                        <option value="doubletee">Double Tees</option>
                        <option value="slab">Slabs</option>
                    </select>
                </div>
                <div class="assets-list" id="assetsList">
                    <div class="loading-message">Loading ACC Assets...</div>
                </div>
            </div>
        </div>

        <!-- Validation Messages -->
        <div class="validation-panel" id="validationPanel" style="display: none;">
            <h3>Validation Issues</h3>
            <div id="validationMessages"></div>
        </div>
    </div>

    <!-- Piece Details Modal -->
    <div class="modal-overlay" id="pieceDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Piece Details</h3>
                <button class="modal-close" onclick="closePieceDetails()">&times;</button>
            </div>
            <div class="modal-content" id="pieceDetailsContent">
                <!-- Dynamic content -->
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closePieceDetails()">Close</button>
                <button class="btn btn-primary" onclick="savePieceChanges()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="scripts/env.js"></script>
    <script src="scripts/production-scheduling.js"></script>
</body>
</html>