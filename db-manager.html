<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB Manager - Metromont El Diablo</title>
    <!-- Reuse existing global styles -->
    <link rel="stylesheet" href="styles/index.css">
    <!-- DB Manager specific styles -->
    <link rel="stylesheet" href="styles/db-manager.css">
    <link rel="stylesheet" href="styles/ai-widget.css">
</head>
<body>
    <!-- Header matching El Diablo style -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <img src="assets/images/metromont-logo.png" alt="Metromont Logo" class="logo" />
                <div class="brand-text">
                    <h1>Metromont DB Manager</h1>
                    <p>Data Management & Storage</p>
                </div>
            </div>
            <div class="nav-breadcrumb">
                <a href="index.html">Dashboard</a>
                <span>→</span>
                <span>DB Manager</span>
            </div>
            <div class="header-buttons">
                <button class="btn btn-back" onclick="window.location.href='index.html'">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                    </svg>
                    Back to Dashboard
                </button>
                <div class="status-badge status-connected" id="dbStatusBadge" style="display: none;">
                    <svg width="12" height="12" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
                    </svg>
                    Connected
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Actions Bar -->
        <div class="db-actions-bar">
            <div class="db-actions-left">
                <button id="btnRefresh" class="btn btn-secondary">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    Refresh
                </button>
                <button id="btnAddTable" class="btn btn-primary">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    Add Table
                </button>
            </div>
            <div class="db-actions-right">
                <span id="dbStatusText" class="status-text">Loading...</span>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="db-layout">
            <!-- Sidebar: Folders & Tables Tree -->
            <aside class="db-sidebar">
                <!-- Folders Panel -->
                <div class="panel-section">
                    <div class="panel-header">
                        <h3>Folders</h3>
                        <div class="panel-actions">
                            <button id="btnRenameFolder" class="btn-secondary btn-sm" disabled>Rename</button>
                            <button id="btnAddFolder" class="btn-primary btn-sm">Add Folder</button>
                            <button id="btnAddSubfolder" class="btn-secondary btn-sm" disabled>Add Subfolder</button>
                        </div>
                    </div>
                    <ul id="folderList" class="folder-list"></ul>
                </div>
                
                <!-- Tables Tree -->
                <div class="panel-section">
                    <div class="db-sidebar-header">
                        <h3>Database Structure</h3>
                    </div>
                    <div id="dbTree" class="db-tree">
                        <div class="loading">Loading...</div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area -->
            <section class="db-content">
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab tab--active" data-tab="tables">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
                        </svg>
                        Tables
                    </button>
                    <button class="tab" data-tab="rows">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                        Rows
                    </button>
                    <button class="tab" data-tab="oss">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 00-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v11z"/>
                        </svg>
                        OSS Objects
                    </button>
                    <div class="tab-spacer"></div>
                    <input type="text" id="ossPrefix" placeholder="Prefix..." class="oss-prefix-input" style="display:none;"/>
                </div>

                <!-- Content Pane -->
                <div id="dbPane" class="db-pane">
                    <div class="loading-message">
                        <p>Select a view to begin</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification">
        <div class="notification-content" id="notificationContent"></div>
    </div>

    <!-- Add Folder Modal -->
    <div id="folderModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Folder</h3>
                <button class="btn-icon" onclick="closeFolderModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="folderName">Folder Name:</label>
                    <input type="text" id="folderName" class="form-control" placeholder="e.g., Schedules">
                </div>
                <div class="form-group">
                    <label for="folderDescription">Description (optional):</label>
                    <textarea id="folderDescription" class="form-control" rows="3" placeholder="What this folder is for..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFolderModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createFolder()">Create</button>
            </div>
        </div>
    </div>

    <!-- Add Table Modal -->
    <div id="tableModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Create Table</h3>
                <button class="btn-icon" onclick="closeTableModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="tableName">Table Name:</label>
                    <input type="text" id="tableName" class="form-control" placeholder="e.g., schedules">
                </div>
                <div class="form-group">
                    <label for="tableFolderId">Folder:</label>
                    <select id="tableFolderId" class="form-control">
                        <option value="">No folder</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tableSchema">JSON Schema:</label>
                    <textarea id="tableSchema" class="form-control code-input" rows="10" placeholder='{"type": "object", "properties": {...}}'></textarea>
                    <small>Enter a valid JSON Schema (draft-07)</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTableModal()">Cancel</button>
                <button class="btn btn-primary" onclick="createTable()">Create</button>
            </div>
        </div>
    </div>

    <!-- AI Floating Action Button -->
    <button id="aiFab" class="ai-fab" aria-label="Open AI Assistant">✦</button>

    <!-- AI Chat Modal -->
    <div id="aiModal" class="ai-modal" aria-hidden="true">
      <div class="ai-modal__backdrop"></div>
      <div class="ai-modal__panel">
        <div class="ai-modal__header">
          <h2>DB AI Assistant</h2>
          <button id="aiClose" class="ai-close" aria-label="Close">×</button>
        </div>
        <div id="aiChat" class="ai-chat"></div>
        <form id="aiForm" class="ai-form">
          <input id="aiInput" type="text" placeholder="e.g., Create a table 'Assets' with columns id, description, status_id" autocomplete="off" required />
          <button id="aiSend" type="submit">Send</button>
        </form>
      </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/env.js"></script>
    <script type="module" src="scripts/fetch-helpers.js"></script>
    <script src="scripts/ai-widget.js"></script>
    <script src="scripts/db-manager.js"></script>
</body>
</html>

